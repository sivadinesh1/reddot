<!-- @format -->

<div class="content">
	<div class="title-row">
		<span>Inquiry Management</span>

		<span>
			<button appPreventDoubleClick (throttledClick)="openBackOrder()" fill="outline" [throttleTime]="2000" mat-stroked-button color="primary">
				Backorder
			</button>
			<span style="width: 16px; display: inline-block;">&nbsp;</span>
			<button mat-raised-button color="primary" (click)="goEnquiryScreen()" style="font-size: 0.8rem; border-radius: 50px;">
				+ New Inquiry
			</button>
		</span>
	</div>

	<form [formGroup]="submitForm">
		<div class="form-wrap">
			<div class="customers">
				<mat-form-field class="width">
					<input
						matInput
						[matAutocomplete]="auto"
						formControlName="customerctrl"
						required
						matTooltip="Type to filter the Customer list"
						matTooltipPosition="after"
					/>
					<button mat-button matSuffix mat-icon-button aria-label="Clear" (click)="clearInput()">
						<mat-icon>close</mat-icon>
					</button>
					<mat-autocomplete #auto="matAutocomplete" (optionSelected)="getPosts($event)">
						<mat-option *ngFor="let customer of filteredCustomer | async" [value]="customer">
							<span>{{ customer.name }} </span>
						</mat-option>
					</mat-autocomplete>
				</mat-form-field>
			</div>
			<div>
				<ion-item class="input-item" lines="none">
					<mat-form-field class="mat-input-wrapper">
						<input
							matInput
							readonly
							[max]="maxDate"
							[matDatepicker]="fromdate"
							formControlName="fromdate"
							placeholder="From date"
							(focus)="fromdate.open()"
							(dateChange)="fromDateSelected($event)"
						/>
						<mat-datepicker-toggle matSuffix [for]="fromdate"></mat-datepicker-toggle>
						<mat-datepicker #fromdate></mat-datepicker>
					</mat-form-field>
				</ion-item>
			</div>
			<div>
				<ion-item class="input-item" lines="none">
					<mat-form-field class="mat-input-wrapper">
						<input
							matInput
							readonly
							[matDatepicker]="todate"
							[max]="maxDate"
							formControlName="todate"
							placeholder="To date"
							(focus)="todate.open()"
							required
							(dateChange)="toDateSelected($event)"
						/>
						<mat-datepicker-toggle matSuffix [for]="todate"></mat-datepicker-toggle>
						<mat-datepicker #todate></mat-datepicker>
					</mat-form-field>
				</ion-item>
			</div>

			<div>
				<mat-form-field class="mat-width-ext">
					<mat-label>Status</mat-label>
					<mat-select formControlName="status" (selectionChange)="statusChange($event)" required value="{statusFlag}">
						<mat-option *ngFor="let item of statusList" [value]="item.id">
							{{item.value}}
						</mat-option>
					</mat-select>
				</mat-form-field>
			</div>
			<div class="search-btn">
				<button mat-raised-button [disabled]="!submitForm.valid" color="primary" style="font-size: 1rem;" (click)="search()">
					Search
				</button>
			</div>

			<!-- <div>
				<mat-form-field class="mat-width-ext">
					<mat-label>Status</mat-label>
					<mat-select formControlName="status" (selectionChange)="statusChange($event)" required value="{statusFlag}">
						<mat-option value="all">
							All
						</mat-option>
						<mat-option *ngFor="let item of statusList" [value]="item.id">
							{{item.value}}
						</mat-option>
					</mat-select>
				</mat-form-field>
			</div> -->
			<!-- <div class="search-btn">
					<button mat-raised-button [disabled]="!submitForm.valid" color="primary" style="font-size: 1rem;" (click)="search()">
						Search
					</button>
				</div> -->
		</div>
	</form>

	<mat-tab-group color="primary" backgroundColor="primary" [(selectedIndex)]="tabIndex" (selectedTabChange)="tabClick($event)">
		<mat-tab label="All Inquiries ({{(enquiries$| async)?.length }})">
			<ng-template [ngTemplateOutlet]="MsgRef"></ng-template>
			<ng-template [ngTemplateOutlet]="MsgRef1"></ng-template>
		</mat-tab>

		<mat-tab label="New ({{(newEnquiries$| async)?.length }})">
			<ng-template [ngTemplateOutlet]="MsgRef"></ng-template>
			<ng-template [ngTemplateOutlet]="MsgRef1"></ng-template>
		</mat-tab>

		<mat-tab label="In Progress ({{(draftEnquiries$| async)?.length }})">
			<ng-template [ngTemplateOutlet]="MsgRef"></ng-template>
			<ng-template [ngTemplateOutlet]="MsgRef1"></ng-template>
		</mat-tab>

		<mat-tab label="Invoice Ready ({{(invoiceReadyEnquiries$| async)?.length }})">
			<ng-template [ngTemplateOutlet]="MsgRef"></ng-template>
			<ng-template [ngTemplateOutlet]="MsgRef1"></ng-template>
		</mat-tab>

		<mat-tab label="Executed ({{(fullfilledEnquiries$| async)?.length }})">
			<ng-template [ngTemplateOutlet]="MsgRef"></ng-template>
			<ng-template [ngTemplateOutlet]="MsgRef1"></ng-template>
		</mat-tab>
	</mat-tab-group>
</div>

<ng-template #MsgRef>
	<div class="header">
		<div>#</div>
		<div>Inq ID</div>
		<div>Customer</div>
		<div>Inquired On</div>
		<div>Status</div>
		<div>Items</div>
		<div></div>
	</div>
</ng-template>

<ng-template #MsgRef1>
	<div *ngFor="let item of filteredValues let idx = index;" class="listItem">
		<div>
			{{idx + 1}}
		</div>
		<div>
			{{item.id}}
		</div>
		<div>
			{{item.customer_name}}
		</div>
		<div>
			{{item.enquiry_date | date: 'dd/MMM/yyyy h:mm a'}}
		</div>
		<div>
			{{item.status_txt }}
		</div>

		<div class="items">
			{{item.noofitems}}
		</div>
		<div>
			<button
				mat-raised-button
				color="primary"
				*ngIf="item.estatus === 'O' "
				(click)="processEnquiry(item)"
				style="font-size: 0.8rem; border-radius: 50px; line-height: 32px; width: 155px;"
			>
				Step 1: Order Process
			</button>

			<button
				mat-stroked-button
				color="primary"
				*ngIf="item.estatus === 'D' "
				(click)="processEnquiry(item)"
				style="font-size: 0.8rem; border-radius: 50px; line-height: 32px; width: 155px;"
			>
				Step 2: In Progress
			</button>

			<button
				mat-raised-button
				color="primary"
				*ngIf="item.estatus === 'P' "
				(click)="moveToSale(item)"
				style="font-size: 0.8rem; border-radius: 50px; line-height: 32px; width: 155px;"
			>
				Step 3: Invoice Ready
			</button>

			<button
				mat-raised-button
				color="primary"
				*ngIf="item.estatus === 'E' "
				(click)="processEnquiry(item)"
				style="font-size: 0.8rem; border-radius: 50px; line-height: 32px; width: 155px;"
			>
				View
			</button>
		</div>
	</div>
</ng-template>
