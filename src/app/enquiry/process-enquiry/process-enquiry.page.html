<!-- @format -->

<ion-content>
	<div class="screen-header">
		<div>
			<span style="color: #310ac0; cursor: pointer" (click)="openEnquiry()">Inquiry Dashboard</span> /
			<span style="color: #797979">Order Processing #{{enqid}}</span>
		</div>
		<div>&nbsp;</div>
	</div>
	<div class="topcontainer">
		<div *ngIf="enqDetailsOrig">
			<form [formGroup]="submitForm" #myForm="ngForm">
				<div class="cust-header">
					<div>
						<mat-form-field class="example-full-width" style="padding-right: 10px">
							<input matInput [matAutocomplete]="auto" formControlName="customerctrl" #typehead1 autofocus required matTooltipPosition="after" />
							<mat-placeholder class="placeholder">Select or Add Customer</mat-placeholder>

							<mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn" (optionSelected)="setCustomerInfo($event, 'click')">
								<mat-option *ngIf="isCLoading" class="is-loading"><mat-spinner diameter="20"></mat-spinner></mat-option>
								<ng-container *ngIf="!isCLoading">
									<mat-option *ngFor="let customer of customer_lis" [value]="customer">
										<span>{{ customer.name }} </span>
									</mat-option>
									<mat-option style="background-color: #f2f2f2" value="new">+ New Customer</mat-option>
								</ng-container>
							</mat-autocomplete>
							<mat-error *ngIf="submitForm.controls['customerctrl'].hasError('required')"> Please enter a value </mat-error>
							<mat-error *ngIf="submitForm.controls['customerctrl'].hasError('incorrect')"> Customer does not exist </mat-error>
							<mat-hint *ngIf="iscustomerselected">
								<span (click)="openDialog($event)" style="font-size: 12px; color: #310ac0; cursor: pointer">View Customer Details</span>
							</mat-hint>
						</mat-form-field>
					</div>

					<div *ngIf="iscustomerselected" style="font-size: 12px; color: #666666; padding: 0.5rem 0.5rem 0.5rem 0px">
						<div style="font-weight: 500; font-size: 14px">BILLING ADDRESS</div>
						<div>{{customerdata.address1 | nullquote}}</div>
						<div>{{customerdata.address2 | nullquote}}</div>

						<div>{{customerdata.state | nullquote}}</div>
						<div>{{customerdata.pin | nullquote}}</div>
					</div>

					<div *ngIf="iscustomerselected" style="padding: 0.5rem 0.5rem 0.5rem 0px; font-size: 12px; color: #666666">
						<div style="font-weight: 500; font-size: 14px">SHIPPING ADDRESS</div>
						<div>{{customerdata.address1 | nullquote}}</div>
						<div>{{customerdata.address2 | nullquote}}</div>

						<div>{{customerdata.state | nullquote}}</div>
						<div>{{customerdata.pin | nullquote}}</div>
					</div>
					<div *ngIf="iscustomerselected" style="padding: 0.5rem 0.5rem 0.5rem 0px; font-size: 12px; color: #666666">
						<div style="font-weight: 500; font-size: 14px">Remarks</div>
						<div>{{enqDetailsOrig[0].remarks}}</div>
					</div>
				</div>
			</form>

			<!-- <div>
				<div class="cust-lbl">Customer:</div>
				<div>
					<div>{{enqDetailsOrig[0].name}}</div>
					<div>{{enqDetailsOrig[0].address1}}</div>
					<div>{{enqDetailsOrig[0].address2}}</div>
					<div>{{enqDetailsOrig[0].district}}</div>
				</div>
			</div> -->
			<div></div>
		</div>
	</div>

	<div class="row1">
		<div class="search_box">
			<ion-searchbar
				autofocus
				debounce="300"
				placeholder="Search by item name"
				#mySearchbar
				show-cancel-button="focus"
				(ionClear)="reset()"
				(ionInput)="applyFilter($event.target.value)"
			></ion-searchbar>
		</div>
		<div class="actions">
			<button appPreventDoubleClick (throttledClick)="openAddItem()" *ngIf="status !== 'E'" [throttleTime]="500" mat-raised-button color="primary">
				+ Add Item
			</button>
		</div>
		<div class="actions">
			<img src="/assets/images/svg/download-excel.svg" style="cursor: pointer" width="32px" height="32px" (click)="exportToExcel()" />
		</div>
	</div>

	<div class="container">
		<ng-container>
			<div class="example-container mat-elevation-z8">
				<div class="example-table-container" #epltable>
					<table mat-table [dataSource]="dataSource" multiTemplateDataRows>
						<ng-container matColumnDef="edit">
							<th mat-header-cell *matHeaderCellDef>&nbsp;</th>
							<td mat-cell *matCellDef="let element; let idx = dataIndex;" style="text-align: center" class="m-card-title">
								<mat-icon
									*ngIf="element.product_code"
									(click)="showAddProductComp(idx + (paginator.pageIndex * paginator.pageSize))"
									style="cursor: pointer"
									>edit
								</mat-icon>
							</td>
						</ng-container>

						<ng-container matColumnDef="prodinfo">
							<th mat-header-cell *matHeaderCellDef>Item Info</th>
							<td mat-cell *matCellDef="let element; let idx = dataIndex;" class="m-card-title">
								{{element.prodinfo}}

								<div *ngIf="element.product_code" class="pdetails">
									<div class="pcode">{{element.product_code}}</div>
									<div class="pdesc">{{element.product_desc}}</div>
								</div>
								<div *ngIf="!element.product_code" class="left-align c-pad" style="cursor: pointer">
									<div class="" *ngIf="!element.product_code" (click)="showAddProductComp(idx + (paginator.pageIndex * paginator.pageSize))">
										<div><img src="/assets/images/svg/more.svg" width="18px" height="18px" /> Item Code</div>
									</div>
								</div>
							</td>
						</ng-container>

						<ng-container matColumnDef="avlstock">
							<th mat-header-cell *matHeaderCellDef>In stock</th>
							<td mat-cell *matCellDef="let element" style="text-align: center" class="m-card-title">{{element.available_stock}}</td>
						</ng-container>

						<ng-container matColumnDef="rackno">
							<th mat-header-cell *matHeaderCellDef>Rack #</th>
							<td mat-cell *matCellDef="let element" class="m-card-title">{{element.rakno}}</td>
						</ng-container>

						<ng-container matColumnDef="alotqty">
							<th mat-header-cell *matHeaderCellDef>A.Qty</th>
							<td mat-cell *matCellDef="let element; let idx = dataIndex;" class="m-card-title">
								<mat-form-field class="qty-width">
									<input matInput type="number" value="{{element.giveqty}}" readonly />
									<mat-icon
										*ngIf="status !== 'E'"
										matSuffix
										style="cursor: pointer"
										(click)="openCurrencyPad(idx + (paginator.pageIndex * paginator.pageSize))"
										>view_comfy</mat-icon
									>
								</mat-form-field>
							</td>
						</ng-container>

						<ng-container matColumnDef="notes">
							<th mat-header-cell *matHeaderCellDef>Notes</th>
							<td mat-cell *matCellDef="let element" class="m-card-title">{{element.notes}}</td>
						</ng-container>

						<ng-container matColumnDef="reqqty">
							<th mat-header-cell *matHeaderCellDef>R.Qty</th>
							<td mat-cell *matCellDef="let element" class="m-card-title">{{element.askqty}}</td>
						</ng-container>

						<ng-container matColumnDef="processed">
							<th mat-header-cell *matHeaderCellDef>R.Qty</th>
							<td mat-cell *matCellDef="let element; let idx = dataIndex;" style="justify-self: center; align-self: center">
								<mat-checkbox
									*ngIf="status !== 'E'"
									[checked]="element.processed === 'YS'? true : false"
									(click)="checkedRow(idx + (paginator.pageIndex * paginator.pageSize))"
								></mat-checkbox>
							</td>
						</ng-container>

						<!-- <ng-container matColumnDef="actions">
							<th mat-header-cell *matHeaderCellDef>&nbsp;</th>
							<td mat-cell *matCellDef="let element">
								<button mat-icon-button [matMenuTriggerFor]="menu" [matMenuTriggerData]="{element: element}">
									<mat-icon>more_vert</mat-icon>
								</button>
							</td>
						</ng-container> -->

						<tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>

						<tr
							class="example-element-row"
							[ngClass]="{'make-gold': row.processed === 'YS' }"
							mat-row
							*matRowDef="let row; columns: displayedColumns; "
						></tr>
					</table>
					<div [hidden]="isTableHasData" class="center-message">No Data available.</div>
				</div>
				<mat-paginator [pageSizeOptions]="[50, 100]" showFirstLastButtons></mat-paginator>
			</div>
		</ng-container>
	</div>
	<ng-container>
		<div class="footer" *ngIf="status !== 'E'">
			<div>
				<div>
					<div *ngIf="status === 'E'">
						<div class="cust-lbl">Status:</div>
						<div style="color: red">Executed</div>
					</div>
					<div *ngIf="status === 'D'">
						<div class="cust-lbl">Status:</div>
						<div style="color: red">Draft</div>
					</div>
					<div *ngIf="status === 'O'">
						<div class="cust-lbl">Status:</div>
						<div style="color: red">New</div>
					</div>
				</div>
			</div>
			<div class="submit">
				<!-- <span class="itms-lbl">Showing {{productarr.controls.length || 0}} Items</span>&nbsp; -->
				<button
					appPreventDoubleClick
					class="cursor"
					(throttledClick)="presentAlertConfirm()"
					[throttleTime]="500"
					mat-stroked-button
					color="primary"
					type="button"
				>
					Ready for Invoice</button
				>&nbsp;
				<button
					appPreventDoubleClick
					class="cursor"
					(throttledClick)="save()"
					type="button"
					[throttleTime]="500"
					mat-raised-button
					type="button"
					color="primary"
				>
					Save Draft
				</button>
			</div>
		</div>
	</ng-container>
</ion-content>
