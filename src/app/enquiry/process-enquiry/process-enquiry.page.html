<ion-content [scrollEvents]="true" (ionScroll)="logScrolling($event)">
	<div class="screen-header" style="padding-bottom: 32px">
		<div>
			<span style="color: #310ac0; cursor: pointer" (click)="openEnquiry()">Inquiry Dashboard</span> /
			<span style="color: #797979">Order Processing #{{enqid}}</span>
		</div>
		<div>&nbsp;</div>
	</div>
	<div class="topcontainer">
		<div *ngIf="enqDetailsOrig">
			<form [formGroup]="submitForm" #myForm="ngForm">
				<div class="cust-header">
					<div>
						<mat-form-field class="example-full-width" style="padding-right: 10px">
							<input matInput [matAutocomplete]="auto" formControlName="customerctrl" #typehead1 required matTooltipPosition="after" />
							<button mat-button matSuffix mat-icon-button type="button" (click)="clearInput()">
								<mat-icon>close</mat-icon>
							</button>
							<mat-placeholder class="placeholder">Select or Add Customer</mat-placeholder>

							<mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn" (optionSelected)="setCustomerInfo($event, 'click')">
								<mat-option *ngIf="isCLoading" class="is-loading"><mat-spinner diameter="20"></mat-spinner></mat-option>
								<ng-container *ngIf="!isCLoading">
									<mat-option *ngFor="let customer of customer_lis" [value]="customer">
										<span>{{ customer.name }} </span>
									</mat-option>
									<mat-option style="background-color: #f2f2f2" value="new">+ New Customer</mat-option>
								</ng-container>
							</mat-autocomplete>
							<mat-error *ngIf="submitForm.controls['customerctrl'].hasError('required')"> Please enter a value </mat-error>
							<mat-error *ngIf="submitForm.controls['customerctrl'].hasError('incorrect')"> Customer does not exist </mat-error>
							<mat-hint *ngIf="iscustomerselected">
								<span (click)="openDialog($event)" style="font-size: 12px; color: #310ac0; cursor: pointer">View Customer Details</span>
							</mat-hint>
						</mat-form-field>
					</div>

					<div *ngIf="iscustomerselected" style="font-size: 12px; color: #666666; padding: 0.5rem 0.5rem 0.5rem 0px">
						<div style="font-weight: 500; font-size: 14px">BILLING ADDRESS</div>
						<div>{{customerdata.address1 | nullquote}}</div>
						<div>{{customerdata.address2 | nullquote}}</div>

						<div>{{customerdata.state | nullquote}}</div>
						<div>{{customerdata.pin | nullquote}}</div>
					</div>

					<div *ngIf="iscustomerselected" style="padding: 0.5rem 0.5rem 0.5rem 0px; font-size: 12px; color: #666666">
						<div style="font-weight: 500; font-size: 14px">SHIPPING ADDRESS</div>
						<div>{{customerdata.address1 | nullquote}}</div>
						<div>{{customerdata.address2 | nullquote}}</div>

						<div>{{customerdata.state | nullquote}}</div>
						<div>{{customerdata.pin | nullquote}}</div>
					</div>
					<div *ngIf="iscustomerselected" style="padding: 0.5rem 0.5rem 0.5rem 0px; font-size: 12px; color: #666666">
						<div style="font-weight: 500; font-size: 14px">Remarks</div>
						<div>{{enqDetailsOrig[0].remarks}}</div>
					</div>
				</div>
			</form>

			<div></div>
		</div>
	</div>

	<div class="row1">
		<div class="search_box">
			<mat-form-field style="width: 320px">
				<mat-icon matPrefix>search</mat-icon>
				<input type="text" matInput [(ngModel)]="searchText" placeholder="Search by Item code / description" />
			</mat-form-field>
		</div>
		<div class="actions">
			<button
				appPreventDoubleClick
				(throttledClick)="beforeAddItemConfirm()"
				*ngIf="status !== 'E'"
				[throttleTime]="500"
				mat-raised-button
				color="primary"
			>
				+ Add Item
			</button>
		</div>
		<div style="text-align: center; align-self: center">
			<span><img src="/assets/images/svg/download-excel.svg" style="cursor: pointer" width="32px" height="32px" (click)="exportToExcel()" /></span>
		</div>
	</div>
	<div #epltable>
		<table>
			<thead>
				<tr class="content">
					<th style="text-align: left; padding-left: 5px; font-weight: 500">
						<img class="cursor" src="/assets/images/svg/trash.svg" width="16px" height="16px" *ngIf="showDelIcon" (click)="presentDeleteConfirm()" />
					</th>
					<th>&nbsp;</th>
					<th style="text-align: left; padding-left: 5px; font-weight: 500">Item Code</th>
					<th style="text-align: left; padding-left: 5px; font-weight: 500">Item Description</th>
					<th style="text-align: right; padding-right: 5px; font-weight: 500">In Stock</th>
					<th style="text-align: left; padding-left: 5px; font-weight: 500">Rack #</th>
					<th style="text-align: right; padding-right: 5px; font-weight: 500">Alloted Qty</th>
					<th [hidden]="true" style="text-align: right; padding-right: 5px; font-weight: 500">Alloted Qty</th>
					<th style="text-align: left; padding-left: 5px; font-weight: 500">Notes</th>
					<th style="text-align: right; padding-right: 5px; font-weight: 500">Required Qty</th>
					<th>&nbsp;</th>
				</tr>
			</thead>
			<tbody>
				<tr
					*ngFor="let item of productArr | appFilter: searchText; let idx = index"
					[ngClass]="{'make-gold': item.processed === 'YS' }"
					class="list-item"
				>
					<td style="text-align: left; padding-left: 5px">
						<div class="txt-align">
							<span>
								<mat-checkbox #myCheckbox (click)="checkedDelRow(idx)"></mat-checkbox>
							</span>
						</div>
					</td>

					<td style="text-align: left; padding-left: 5px">
						<div class="txt-align">
							<span>
								<mat-icon *ngIf="item.product_code" (click)="showAddProductComp(idx)" style="cursor: pointer">edit </mat-icon>
							</span>
						</div>
					</td>

					<td style="text-align: left; padding-left: 5px">
						{{item.product_code}}
						<div *ngIf="!item.product_code" class="left-align" style="cursor: pointer">
							<div class="" *ngIf="!item.product_code" (click)="showAddProductComp(idx)">
								<div><img src="/assets/images/svg/more.svg" width="18px" height="18px" /> Item Code</div>
							</div>
						</div>
					</td>
					<td style="text-align: left; padding-left: 5px">{{item.product_desc}}</td>
					<td style="text-align: right; padding-right: 5px">{{item.available_stock}}</td>
					<td style="text-align: left">{{item.rackno}}</td>
					<td style="text-align: right; padding-right: 5px">
						<mat-form-field class="qty-width" style="margin-bottom: -1.25em" (click)="openCurrencyPad(idx)">
							<input matInput type="number" value="{{item.giveqty}}" class="cursor" readonly />
							<mat-icon *ngIf="status !== 'E'" matSuffix style="cursor: pointer" matSuffix>view_comfy</mat-icon>
						</mat-form-field>
					</td>

					<td [hidden]="true">{{item.giveqty}}</td>
					<td style="text-align: left; padding-left: 5px">{{item.notes}}</td>
					<td style="text-align: right; padding-right: 5px">{{item.askqty}}</td>
					<td style="text-align: center">
						<mat-slide-toggle *ngIf="status !== 'E'" [checked]="item.processed === 'YS'? true : false" (click)="checkedRow(idx)"></mat-slide-toggle>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
	<div class="empty-add">&nbsp;</div>
	<div>
		<div class="footer" *ngIf="status !== 'E'">
			<div style="display: flex">
				<span style="padding: 0px 10px">
					<div *ngIf="status === 'E'">
						<div style="font-size: 12px; color: #797979">Status:</div>
						<div style="font-size: 24px">Executed</div>
					</div>
					<div *ngIf="status === 'D'">
						<div style="font-size: 12px; color: #797979">Status:</div>
						<div style="font-size: 24px">Draft</div>
					</div>
					<div *ngIf="status === 'O'">
						<div style="font-size: 12px; color: #797979">Status:</div>
						<div style="font-size: 24px">New</div>
					</div>
				</span>
				<span style="padding: 0px 10px">
					<div style="font-size: 12px; color: #797979"># Items</div>
					<div style="font-size: 24px">{{productArr.length || 0 }}</div>
				</span>
			</div>
			<div class="submit">
				<button
					appPreventDoubleClick
					class="cursor"
					(click)="presentCancelConfirm()"
					[throttleTime]="500"
					mat-stroked-button
					color="primary"
					type="button"
					[disabled]="clicked"
				>
					Cancel</button
				>&nbsp;
				<button
					appPreventDoubleClick
					class="cursor"
					(throttledClick)="presentAlertConfirm()"
					[throttleTime]="500"
					mat-stroked-button
					color="primary"
					type="button"
					[disabled]="clicked"
				>
					Ready for Invoice</button
				>&nbsp;
				<button
					appPreventDoubleClick
					class="cursor"
					(throttledClick)="save('draft')"
					type="button"
					[throttleTime]="500"
					mat-raised-button
					type="button"
					color="primary"
					[disabled]="clicked"
				>
					Save Draft
				</button>
			</div>
		</div>
	</div>
	<ngx-spinner size="medium"></ngx-spinner>
</ion-content>

<!-- <div [hidden]="isTableHasData" class="center-message">No Data available.</div> -->
