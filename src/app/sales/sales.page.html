<ion-content>
	<div class="screen-header">
		<div>
			<span style="color: #310ac0; cursor: pointer;" (click)="salesDashboard()">Sales Dashboard</span> /
			<span style="color: #797979;">New Sale</span>
		</div>
		<div>
			&nbsp;
		</div>
	</div>

	<!-- <div class="screen-header">
		<div>
			<div *ngIf="customerselected" style="color: #797979; font-size: 12px;">Customer Name</div>
			<span matTooltip="{{customerselected}}">{{customername}}</span>
			<span *ngIf="customerselected" (click)="showAllCustomersComp()" class="cursor">
				<span style="font-size: 12px; color: rgb(31, 31, 179);">&nbsp;(Change)</span>
			</span>
		</div>

		<ng-container *ngIf="customerselected; then showPlusProduct; else showPlusCustomer"> </ng-container>

		<ng-template #showPlusCustomer>
			<div class="add-actn cursor">
				<button appPreventDoubleClick (throttledClick)="showAllCustomersComp()" [throttleTime]="2000" mat-raised-button color="primary">
					+ Add Customer
				</button>
			</div>
		</ng-template>
		<ng-template #showPlusProduct>
			<div *ngIf="listArr.length >= 0" class="add-actn">
				<button
					appPreventDoubleClick
					[throttleTime]="2000"
					(throttledClick)="customerselected && showAddProductComp()"
					mat-raised-button
					color="primary"
				>
					+ Add Item
				</button>
			</div>
		</ng-template>
	</div> -->

	<form [formGroup]="submitForm">
		<div class="purchase-wrap">
			<div class="wrap">
				<div class="acton-btns">
					<img class="cursor" src="/assets/svg/trash.svg" width="16px" height="16px" *ngIf="showDelIcon" (click)="presentDeleteConfirm()" />
					<span class="sub-menu cursor" *ngIf="showDelIcon" (click)="presentDeleteConfirm()">Delete</span>
				</div>

				<div class="acton-btns">
					<img class="cursor" src="/assets/svg/edit.svg" width="16px" height="16px" *ngIf="singleRowSelected" (click)="editTax()" /><span
						class="sub-menu cursor"
						*ngIf="singleRowSelected"
						(click)="editTax()"
						>Tax</span
					>
				</div>
				<div class="acton-btns">
					<img class="cursor" src="/assets/svg/edit.svg" width="16px" height="16px" *ngIf="singleRowSelected" (click)="editMrp()" />
					<span class="sub-menu cursor" *ngIf="singleRowSelected" (click)="editMrp()">Mrp</span>
				</div>

				<div class="sub-menu">Total Items:{{listArr.length}}</div>
			</div>

			<div class="left" *ngIf="listArr.length !== 0">
				<div class="row1">
					<div class="item1 headstyl-left txt-center-align">#</div>
					<div class="item2 headstyl-left">Item Information</div>
					<div class="item3 headstyl-right">MRP</div>
					<div class="item3 headstyl-right">Qty</div>
					<div class="item3 headstyl-center">Discount %</div>
					<div class="item3 headstyl-right">Rate Item</div>

					<div class="item4 headstyl-right">Total Value</div>

					<div class="item4 headstyl-right">Tax %</div>

					<div class="item4 headstyl txt-center-align tax-style">
						<ng-container *ngIf="customerselected">
							<div *ngIf="i_gst" class="headstyl-center" style="font-size: 14px;">IGST</div>
							<div *ngIf="!i_gst" class="headstyl-center" style="font-size: 14px;">CGST / SGST</div>
						</ng-container>
					</div>
					<div class="item4 headstyl-right">Net Value</div>
				</div>
				<div class="row2">
					<!-- <ng-template #beginsetup>
						<div class="empty-add">
							<span class="cursor" appPreventDoubleClick [throttleTime]="2000" (throttledClick)="showAllCustomersComp()">
								+ Add Customer
							</span>
						</div>
					</ng-template> -->
					<ng-template *ngIf="getLength() !== 0">
						<!-- <div *ngIf="listArr.length === 0" class="empty-add">
							<span class="cursor" appPreventDoubleClick [throttleTime]="2000" (throttledClick)="customerselected && showAddProductComp()">
								+ Add Item
							</span>
						</div> -->
						<div *ngFor="let item of listArr ? listArr : []; let idx = index" class="list-item">
							<div class="txt-align">
								<!-- {{idx + 1}} -->
								<mat-checkbox #myCheckbox (click)="checkedRow(idx)"></mat-checkbox>
							</div>
							<div class="item2">
								{{item.product_code}}
								<div class="desc">
									{{item.product_desc}}
								</div>
							</div>

							<div class="item4 txt-right-align num-format-cell-style">{{item.mrp | number:'1.2-2'}}</div>

							<div class="item4 txt-right-align num-format-cell-style">
								<mat-form-field class="example-full-width cursor" (click)="openCurrencyPad(idx)">
									<input matInput type="number" value="{{item.qty}}" class="cursor" readonly />
									<mat-icon matSuffix>view_comfy</mat-icon>
								</mat-form-field>
							</div>

							<div class="item4 txt-right-align num-format-cell-style">
								<input
									matInput
									value="{{item.disc_percent | number:'1.2-2'}}"
									type="number"
									maxlength="3"
									min="0"
									max="100"
									class="styl-txt-box-small txt-pad"
									(click)="openRowNumberPad(idx,'discount')"
									appPreventCutCopyPaste
									readonly
								/>
							</div>

							<div class="item4 txt-right-align num-format-cell-style">{{item.unit_price}}</div>

							<div class="item4 txt-right-align num-format-cell-style">
								{{item.taxable_value }}
							</div>

							<div class="item4 txt-right-align num-format-cell-style">
								{{item.taxrate}}
							</div>

							<div class="txt-align">
								<ng-container *ngIf="i_gst">
									{{(item.tax_value) }}
								</ng-container>
								<ng-container *ngIf="!i_gst">
									{{(item.tax_value / 2) | number:'1.2-2'}} / {{(item.tax_value / 2) | number:'1.2-2'}}
								</ng-container>
							</div>

							<div class="item4 txt-right-align num-format-cell-style">
								<span [ngClass]="marginCheck(item.margin)">
									{{item.total_value }}
								</span>
							</div>
						</div>
					</ng-template>
				</div>

				<div class="row4">
					<div class="item">
						<div class="align-self-center overview">Overview</div>
						<div class="align-self-center">&nbsp;</div>
						<div>Total Items</div>
						<div>{{listArr.length}}</div>
					</div>
					<div class="item">
						<div class="subitem align-self-center" *ngIf="i_gst">IGST</div>
						<div class="subitem align-self-center" *ngIf="i_gst">{{igstTotal | number:'1.2-2'}}</div>

						<div class="subitem align-self-center" *ngIf="!i_gst">CGST</div>
						<div class="subitem align-self-center" *ngIf="!i_gst">{{cgstTotal | number:'1.2-2'}}</div>

						<div class="subitem align-self-center" *ngIf="!i_gst">SGST</div>
						<div class="subitem align-self-center" *ngIf="!i_gst">{{sgstTotal | number:'1.2-2'}}</div>
					</div>
					<div class="item">
						<div class="align-self-center txt-right-align">Total:</div>
						<div class="align-self-center left-pad20 fsize40 fweight500">
							{{this.total | number:'1.2-2'}}
						</div>
					</div>
				</div>
			</div>

			<div class="purchase-wrap1">
				<div class="row1">
					<fieldset>
						<legend>Customer</legend>
						<div style="grid-column: 1/-1;">{{customername}}</div>
						<div class="row">
							<ion-item class="input-item" lines="none">
								<mat-form-field class="mat-input-wrapper" floatLabel="always">
									<mat-placeholder>Invoice #</mat-placeholder>
									<input matInput type="text" formControlName="invoiceno" readonly />
								</mat-form-field>
							</ion-item>
						</div>

						<div>
							<ion-item class="input-item" lines="none">
								<mat-form-field class="mat-input-wrapper">
									<input
										matInput
										readonly
										required
										formControlName="invoicedate"
										[matDatepicker]="picker1"
										type="text"
										(focus)="picker1.open()"
										[max]="maxDate"
										(dateChange)="invoiceDateSelected($event)"
									/>
									<mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
									<mat-datepicker touchUi="true" #picker1></mat-datepicker>
									<mat-placeholder>Invoice Date</mat-placeholder>
									<mat-error
										*ngIf="(submitForm.get('invoicedate').hasError('required') || submitForm.get('invoicedate').hasError('patternInvalid'))  && submitForm.get('invoicedate').touched"
									>
										Invalid (or) Missing entry
									</mat-error>
								</mat-form-field>
							</ion-item>
						</div>

						<div>
							<ion-item class="input-item" lines="none">
								<mat-form-field class="mat-input-wrapper">
									<input matInput placeholder="Order #" #orderno type="text" formControlName="orderno" />

									<mat-error
										*ngIf="(submitForm.get('orderno').hasError('required') || submitForm.get('orderno').hasError('patternInvalid'))  && submitForm.get('orderno').touched"
									>
										Invalid (or) Missing entry
									</mat-error>
								</mat-form-field>
							</ion-item>
						</div>
						<div>
							<ion-item class="input-item" lines="none">
								<mat-form-field class="mat-input-wrapper">
									<input
										matInput
										readonly
										[matDatepicker]="pickerod"
										placeholder="Order date"
										formControlName="orderdate"
										(focus)="pickerod.open()"
										[max]="maxOrderDate"
									/>
									<mat-datepicker-toggle matSuffix [for]="pickerod"></mat-datepicker-toggle>
									<mat-datepicker #pickerod></mat-datepicker>
								</mat-form-field>
							</ion-item>
						</div>
					</fieldset>

					<fieldset>
						<legend>Misc Details</legend>
						<div>
							<ion-item class="input-item" lines="none">
								<mat-form-field class="mat-input-wrapper">
									<input matInput placeholder="Lr #" #lrno type="text" formControlName="lrno" />

									<mat-error
										*ngIf="(submitForm.get('lrno').hasError('required') || submitForm.get('lrno').hasError('patternInvalid'))  && submitForm.get('lrno').touched"
									>
										Invalid (or) Missing entry
									</mat-error>
								</mat-form-field>
							</ion-item>
						</div>
						<div>
							<ion-item class="input-item" lines="none">
								<mat-form-field class="mat-input-wrapper">
									<input
										matInput
										readonly
										[matDatepicker]="pickerlr"
										placeholder="Lr date"
										(focus)="pickerlr.open()"
										formControlName="lrdate"
										[max]="maxDate"
									/>
									<mat-datepicker-toggle matSuffix [for]="pickerlr"></mat-datepicker-toggle>
									<mat-datepicker #pickerlr></mat-datepicker>
								</mat-form-field>
							</ion-item>
						</div>
						<div>
							<ion-item class="input-item" lines="none">
								<mat-form-field class="mat-input-wrapper">
									<input
										matInput
										readonly
										[matDatepicker]="pickerrcvd"
										placeholder="Shipped date"
										formControlName="orderrcvddt"
										(focus)="pickerrcvd.open()"
										[max]="maxDate"
									/>
									<mat-datepicker-toggle matSuffix [for]="pickerrcvd"></mat-datepicker-toggle>
									<mat-datepicker #pickerrcvd></mat-datepicker>
								</mat-form-field>
							</ion-item>
						</div>
						<div>
							<ion-item class="input-item">
								<ion-label>
									# of Boxes
								</ion-label>

								<div class="item4 txt-right-align num-format-cell-style">
									<mat-form-field class="example-full-width cursor">
										<input matInput type="number" formControlName="noofboxes" />
										<mat-icon matSuffix (click)="openNumberPad('noofboxes')">view_comfy</mat-icon>
									</mat-form-field>
								</div>
							</ion-item>
						</div>
					</fieldset>

					<fieldset>
						<legend>Misc Details</legend>
						<div>
							<ion-item class="input-item">
								<ion-label>
									Transport Chrgs
								</ion-label>

								<div class="item4 txt-right-align num-format-cell-style">
									<mat-form-field class="example-full-width cursor">
										<input matInput type="number" formControlName="transport_charges" />
										<mat-icon matSuffix (click)="openNumberPad('transport_charges')">view_comfy</mat-icon>
									</mat-form-field>
								</div>
							</ion-item>
						</div>
						<div>
							<ion-item class="input-item">
								<ion-label>
									Unloading Chrgs
								</ion-label>

								<div class="item4 txt-right-align num-format-cell-style">
									<mat-form-field class="example-full-width cursor">
										<input matInput type="number" formControlName="unloading_charges" />
										<mat-icon matSuffix (click)="openNumberPad('unloading_charges')">view_comfy</mat-icon>
									</mat-form-field>
								</div>
							</ion-item>
						</div>
						<div>
							<ion-item class="input-item">
								<ion-label>
									Misc Chrgs
								</ion-label>

								<div class="item4 txt-right-align num-format-cell-style">
									<mat-form-field class="example-full-width cursor">
										<input matInput type="number" formControlName="misc_charges" />
										<mat-icon matSuffix (click)="openNumberPad('misc_charges')">view_comfy</mat-icon>
									</mat-form-field>
								</div>
							</ion-item>
						</div>
					</fieldset>
					<!-- *ngIf="(submitForm.get('status') !== "C")" -->

					<div style="display: grid; align-content: center; justify-content: center;">
						<button
							*ngIf="(submitForm.get('status').value !== 'C' ) "
							appPreventDoubleClick
							[throttleTime]="1000"
							(throttledClick)="onSubmit('draft')"
							mat-raised-button
							color="primary"
							style="font-size: 1rem; padding: 0px 20px;"
						>
							Save as Draft
						</button>

						<br />
						<button
							appPreventDoubleClick
							[throttleTime]="1000"
							(throttledClick)="onSubmit('add')"
							mat-raised-button
							color="primary"
							style="font-size: 1rem; padding: 0px 20px;"
						>
							Generate Invoice
						</button>
						<!-- <button
							appPreventDoubleClick
							[throttleTime]="1000"
							(throttledClick)="onPrint()"
							mat-raised-button
							color="primary"
							style="font-size: 1rem; padding: 0px 20px;"
						>
							Print
						</button> -->
					</div>
				</div>
			</div>
		</div>

		<div class="enq-bottom">
			<mat-card style="background-color: #eee;">
				<div class="customer">
					<div>
						<mat-form-field class="example-full-width" style="padding-right: 10px;">
							<input matInput [matAutocomplete]="auto" formControlName="customerctrl" #typehead1 autofocus required matTooltipPosition="after" />
							<mat-placeholder class="placeholder">Select Customer</mat-placeholder>
							<button mat-button matSuffix mat-icon-button aria-label="Clear" type="button" (click)="clearInput()">
								<mat-icon>close</mat-icon>
							</button>

							<mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn" (optionSelected)="setCustomerInfo($event, 'click')">
								<mat-option *ngIf="isCLoading" class="is-loading"><mat-spinner diameter="20"></mat-spinner></mat-option>
								<ng-container *ngIf="!isCLoading">
									<mat-option *ngFor="let customer of customer_lis" [value]="customer">
										<span>{{ customer.name }} </span>
									</mat-option>
								</ng-container>
							</mat-autocomplete>
							<mat-error *ngIf="submitForm.controls['customerctrl'].hasError('required')">
								Please enter a value
							</mat-error>
							<mat-error *ngIf="submitForm.controls['customerctrl'].hasError('incorrect')">
								Please select a valid project
							</mat-error>
						</mat-form-field>
					</div>
					<div class="cust-info">
						<div *ngIf="iscustomerselected">
							<div>
								<span>Address1:&nbsp;</span>
								<span>{{address1 | nullna}}</span>
							</div>
							<div>
								<span>Address2:&nbsp;</span>
								<span>{{address2 | nullna}}</span>
							</div>
						</div>
					</div>
					<div class="cust-info" style="justify-content: center;">
						<div *ngIf="iscustomerselected">
							<div>
								<span>District:&nbsp;</span>
								<span>{{district | nullna}}</span>
							</div>
							<div>
								<span>GST:&nbsp;</span>
								<span>{{gst | nullna}}</span>
							</div>
						</div>
					</div>

					<div class="cust-info">
						<div *ngIf="iscustomerselected">
							<div>
								<span>Phone:&nbsp;</span>
								<span>{{phone | nullna}}</span>
							</div>
							<div>
								<span>Whatsapp:&nbsp;</span>
								<span>{{gst | nullna}}</span>
							</div>
						</div>
					</div>
				</div>
				<div class="main-add">
					<div>
						<mat-form-field class="example-full-width">
							<input matInput [matAutocomplete]="auto1" formControlName="productctrl" #typehead #plist matTooltipPosition="after" />
							<mat-placeholder class="placeholder">Select Item Code</mat-placeholder>
							<button mat-button matSuffix mat-icon-button aria-label="Clear" type="button" (click)="clearProdInput()">
								<mat-icon>close</mat-icon>
							</button>

							<mat-autocomplete #auto1="matAutocomplete" [displayWith]="displayProdFn" (optionSelected)="setItemDesc($event, 'click')">
								<mat-option *ngIf="isLoading" class="is-loading"><mat-spinner diameter="20"></mat-spinner></mat-option>
								<ng-container *ngIf="!isLoading">
									<mat-option *ngFor="let product of product_lis" [value]="product" style="padding-top: 16px; padding-bottom: 16px;">
										<div style="font-size: 16px; line-height: 1em;">{{ product.product_code }}</div>
										<div style="font-size: 14px; line-height: 1em;">{{ product.description }}</div>
										<div style="font-size: 14px; line-height: 1em;">{{ product.mrp }}</div>
									</mat-option>
								</ng-container>
							</mat-autocomplete>

							<mat-error *ngIf="submitForm.controls['productctrl'].hasError('incorrect')">
								Invalid product code
							</mat-error>
						</mat-form-field>
					</div>
					<div>
						<mat-form-field class="example-full-width">
							<input matInput type="text" formControlName="tempdesc" required />
							<mat-placeholder class="placeholder">Item description</mat-placeholder>
							<mat-error *ngIf="submitForm.controls['tempdesc'].hasError('required')">
								Please enter a value
							</mat-error>
						</mat-form-field>
					</div>

					<div>
						<mat-form-field class="example-full-width">
							<mat-label>Qty</mat-label>
							<input matInput type="number" min="1" max="1000" formControlName="tempqty" required />
							<mat-hint matTooltip="Info about the action">Hint: Max 1000</mat-hint>
						</mat-form-field>
					</div>
					<div>
						<button mat-stroked-button color="primary" type="button" (click)="add()">+ New Row</button>
					</div>
				</div>
			</mat-card>
		</div>

		<ng-container>
			<div class="footer">
				<div class="submit">
					<!-- <span class="itms-lbl">Showing {{productarr.controls.length || 0}} Items</span>&nbsp; -->
					<button
						appPreventDoubleClick
						class="cursor"
						(throttledClick)="presentAlertConfirm()"
						[throttleTime]="500"
						mat-stroked-button
						color="primary"
						type="button"
					>
						Clear All</button
					>&nbsp;
					<button
						appPreventDoubleClick
						class="cursor"
						(throttledClick)="onSubmit()"
						type="button"
						[throttleTime]="500"
						mat-raised-button
						type="button"
						color="primary"
					>
						New Sales
					</button>
				</div>
			</div>
		</ng-container>
	</form>
</ion-content>
