<!-- @format -->

<div class="search-wrap">
	<div class="title-row">
		<span>Purchase Management</span>
		<button mat-raised-button color="warn" (click)="goPurchaseAddScreen()" style="font-size: 1rem;" (click)="search()">
			+ Add to Stock
		</button>
	</div>
	<form [formGroup]="submitForm">
		<div class="form-wrap">
			<div class="vendors">
				<mat-form-field class="mat-width-ext">
					<mat-label>Vendors</mat-label>
					<mat-select formControlName="vendorid" value="{selectedVend}" (selectionChange)="selectedVendor($event)">
						<mat-option value="all">
							All
						</mat-option>
						<mat-option *ngFor="let item of (vendor$ | async)" [value]="item.id">
							{{item.name}}
						</mat-option>
					</mat-select>
				</mat-form-field>
			</div>
			<div>
				<ion-item class="input-item" lines="none">
					<mat-form-field class="mat-input-wrapper">
						<input
							matInput
							readonly
							[max]="maxDate"
							[matDatepicker]="fromdate"
							formControlName="fromdate"
							placeholder="From date"
							(focus)="fromdate.open()"
							(dateChange)="fromDateSelected($event)"
						/>
						<mat-datepicker-toggle matSuffix [for]="fromdate"></mat-datepicker-toggle>
						<mat-datepicker #fromdate></mat-datepicker>
					</mat-form-field>
				</ion-item>
			</div>
			<div>
				<ion-item class="input-item" lines="none">
					<mat-form-field class="mat-input-wrapper">
						<input
							matInput
							readonly
							[matDatepicker]="todate"
							[max]="maxDate"
							formControlName="todate"
							placeholder="To date"
							(focus)="todate.open()"
							required
							(dateChange)="toDateSelected($event)"
						/>
						<mat-datepicker-toggle matSuffix [for]="todate"></mat-datepicker-toggle>
						<mat-datepicker #todate></mat-datepicker>
					</mat-form-field>
				</ion-item>
			</div>
			<div>
				<mat-form-field class="mat-width-ext">
					<mat-label>Status</mat-label>
					<mat-select formControlName="status" (selectionChange)="statusChange($event)" required value="{statusFlag}">
						<mat-option *ngFor="let item of statusList" [value]="item.id">
							{{item.value}}
						</mat-option>
					</mat-select>
				</mat-form-field>
			</div>
			<div class="search-btn">
				<button mat-raised-button [disabled]="!submitForm.valid" color="primary" style="font-size: 1rem;" (click)="search()">
					Search
				</button>
			</div>
		</div>
	</form>

	<div style="display: flex; justify-content: space-between; padding-top: 30px;">
		<div>
			List of Purchaes
		</div>
		<div style="font-size: 12px; color: #797979;">
			{{(purchases$| async)?.length }} Records
		</div>
	</div>
	<div class="header header-style">
		<div>
			Invoice #
		</div>
		<div>
			Invoice Date
		</div>
		<div>
			Vendor Name
		</div>
		<div>
			# of Items
		</div>
		<div>
			Total Value
		</div>
		<div>
			&nbsp;
		</div>
	</div>

	<!-- transform(value: any, format?: string, timezone?: string, locale?: string): string | null; -->

	<div *ngFor="let item of (purchases$ | async) " class="listItem">
		<div class="item">{{item.invoice_no}}</div>
		<div class="item">{{item.invoice_date }}</div>
		<div class="item">{{item.vendor_name}}</div>
		<div class="item">{{item.no_of_items}}</div>
		<div class="item">{{item.total_value}}</div>
		<div class="item">{{item.status === 'D' ? 'Draft' : 'Completed'}}</div>

		<div class="item cursor">
			<img src="/assets/images/svg/edit.svg" width="18px" height="18px" (click)="goPurchaseEditScreen(item)" />
		</div>
		<div class="item cursor" *ngIf="item.status === 'D'">
			<img src="/assets/images/svg/trash.svg" width="18px" height="18px" (click)="presentAlertConfirm(item)" />
		</div>
	</div>

	<ion-fab vertical="bottom" horizontal="end" slot="fixed">
		<ion-fab-button (click)="goPurchaseAddScreen()">
			<ion-icon name="add"></ion-icon>
		</ion-fab-button>
	</ion-fab>
</div>
